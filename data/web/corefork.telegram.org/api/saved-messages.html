<!DOCTYPE html>
<html class="">
  <head>
    <meta charset="utf-8">
    <title>Saved messages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="description" content="The Saved Messages chat allows users to bookmark messages and media: it&#39;s a personal cloud storage for any messages or media you may want to send or forward there.">
    <meta property="og:title" content="Saved messages">
    <meta property="og:image" content="">
    <meta property="og:description" content="The Saved Messages chat allows users to bookmark messages and media: it&#39;s a personal cloud storage for any messages or media you may want to send or forward there.">
    <link rel="icon" type="image/svg+xml" href="/img/website_icon.svg?4">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="alternate icon" href="/img/favicon.ico" type="image/x-icon" />
    <link href="/css/bootstrap.min.css?3" rel="stylesheet">
    
    <link href="/css/telegram.css?248" rel="stylesheet" media="screen">
    <style>
    </style>
  </head>
  <body class="preload">
    <div class="dev_page_wrap">
      <div class="dev_page_head navbar navbar-static-top navbar-tg">
        <div class="navbar-inner">
          <div class="container clearfix">
            <ul class="nav navbar-nav navbar-right hidden-xs"><li class="navbar-twitter"><a href="https://twitter.com/telegram" target="_blank" data-track="Follow/Twitter" onclick="trackDlClick(this, event)"><i class="icon icon-twitter"></i><span> Twitter</span></a></li></ul>
            <ul class="nav navbar-nav">
              <li><a href="//telegram.org/">Home</a></li>
<li class="hidden-xs"><a href="//telegram.org/faq">FAQ</a></li>
<li class="hidden-xs"><a href="//telegram.org/apps">Apps</a></li>
<li class="active"><a href="/api">API</a></li>
<li class=""><a href="/mtproto">Protocol</a></li>
<li class=""><a href="/schema">Schema</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="container clearfix">
        <div class="dev_page">
          <div id="dev_page_content_wrap" class=" ">
  <div class="dev_page_bread_crumbs"><ul class="breadcrumb clearfix"><li><a  href="/api" >API</a></li><i class="icon icon-breadcrumb-divider"></i><li><a  href="/api/saved-messages" >Saved messages</a></li></ul></div>
  <h1 id="dev_page_title">Saved messages</h1>
  
  <div id="dev_page_content"><!-- scroll_nav -->

<p>The Saved Messages chat allows users to bookmark messages and media: it's a personal cloud storage for any messages or media you may want to send or forward there.  </p>
<p>Internally, the Saved Messages chat is simply the private chat with ourselves (i.e. the chat with <a href="/constructor/inputPeerSelf">inputPeerSelf</a>): the only difference between the Saved Messages chat and a chat with any other user, is that additional features are available to better organize messages and media sent to it.  </p>
<h3><a class="anchor" href="#saved-message-dialogs" id="saved-message-dialogs" name="saved-message-dialogs"><i class="anchor-icon"></i></a>Saved message dialogs</h3>
<p>Schema:</p>
<pre><code><a href='/constructor/message'>message</a>#9815cec8 flags:<a href='/type/%23'>#</a> out:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/constructor/true'>true</a> mentioned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.4?<a href='/constructor/true'>true</a> media_unread:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.5?<a href='/constructor/true'>true</a> silent:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.13?<a href='/constructor/true'>true</a> post:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.14?<a href='/constructor/true'>true</a> from_scheduled:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.18?<a href='/constructor/true'>true</a> legacy:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.19?<a href='/constructor/true'>true</a> edit_hide:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.21?<a href='/constructor/true'>true</a> pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.24?<a href='/constructor/true'>true</a> noforwards:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.26?<a href='/constructor/true'>true</a> invert_media:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.27?<a href='/constructor/true'>true</a> flags2:<a href='/type/%23'>#</a> offline:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.1?<a href='/constructor/true'>true</a> video_processing_pending:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.4?<a href='/constructor/true'>true</a> paid_suggested_post_stars:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.8?<a href='/constructor/true'>true</a> paid_suggested_post_ton:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.9?<a href='/constructor/true'>true</a> id:<a href='/type/int'>int</a> from_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.8?<a href='/type/Peer'>Peer</a> from_boosts_applied:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.29?<a href='/type/int'>int</a> peer_id:<a href='/type/Peer'>Peer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.28?<a href='/type/Peer'>Peer</a> fwd_from:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/MessageFwdHeader'>MessageFwdHeader</a> via_bot_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.11?<a href='/type/long'>long</a> via_business_bot_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.0?<a href='/type/long'>long</a> reply_to:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/type/MessageReplyHeader'>MessageReplyHeader</a> date:<a href='/type/int'>int</a> message:<a href='/type/string'>string</a> media:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.9?<a href='/type/MessageMedia'>MessageMedia</a> reply_markup:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.6?<a href='/type/ReplyMarkup'>ReplyMarkup</a> entities:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.7?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/MessageEntity'>MessageEntity</a>&gt; views:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.10?<a href='/type/int'>int</a> forwards:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.10?<a href='/type/int'>int</a> replies:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.23?<a href='/type/MessageReplies'>MessageReplies</a> edit_date:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.15?<a href='/type/int'>int</a> post_author:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.16?<a href='/type/string'>string</a> grouped_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.17?<a href='/type/long'>long</a> reactions:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.20?<a href='/type/MessageReactions'>MessageReactions</a> restriction_reason:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.22?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/RestrictionReason'>RestrictionReason</a>&gt; ttl_period:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.25?<a href='/type/int'>int</a> quick_reply_shortcut_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.30?<a href='/type/int'>int</a> effect:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.2?<a href='/type/long'>long</a> factcheck:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.3?<a href='/type/FactCheck'>FactCheck</a> report_delivery_until_date:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.5?<a href='/type/int'>int</a> paid_message_stars:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.6?<a href='/type/long'>long</a> suggested_post:<a href='/mtproto/TL-combinators#conditional-fields'>flags2</a>.7?<a href='/type/SuggestedPost'>SuggestedPost</a> = <a href='/type/Message'>Message</a>;
<a href='/constructor/messageFwdHeader'>messageFwdHeader</a>#4e4df4bb flags:<a href='/type/%23'>#</a> imported:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.7?<a href='/constructor/true'>true</a> saved_out:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.11?<a href='/constructor/true'>true</a> from_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/Peer'>Peer</a> from_name:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.5?<a href='/type/string'>string</a> date:<a href='/type/int'>int</a> channel_post:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/int'>int</a> post_author:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/type/string'>string</a> saved_from_peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.4?<a href='/type/Peer'>Peer</a> saved_from_msg_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.4?<a href='/type/int'>int</a> saved_from_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.8?<a href='/type/Peer'>Peer</a> saved_from_name:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.9?<a href='/type/string'>string</a> saved_date:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.10?<a href='/type/int'>int</a> psa_type:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.6?<a href='/type/string'>string</a> = <a href='/type/MessageFwdHeader'>MessageFwdHeader</a>;

<a href='/constructor/savedDialog'>savedDialog</a>#bd87cb6c flags:<a href='/type/%23'>#</a> pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/constructor/true'>true</a> peer:<a href='/type/Peer'>Peer</a> top_message:<a href='/type/int'>int</a> = <a href='/type/SavedDialog'>SavedDialog</a>;

<a href='/constructor/updateSavedDialogPinned'>updateSavedDialogPinned</a>#aeaf9e74 flags:<a href='/type/%23'>#</a> pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/constructor/true'>true</a> peer:<a href='/type/DialogPeer'>DialogPeer</a> = <a href='/type/Update'>Update</a>;
<a href='/constructor/updatePinnedSavedDialogs'>updatePinnedSavedDialogs</a>#686c85a6 flags:<a href='/type/%23'>#</a> order:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/DialogPeer'>DialogPeer</a>&gt; = <a href='/type/Update'>Update</a>;

<a href='/constructor/messages.savedDialogs'>messages.savedDialogs</a>#f83ae221 dialogs:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/SavedDialog'>SavedDialog</a>&gt; messages:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Message'>Message</a>&gt; chats:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Chat'>Chat</a>&gt; users:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/User'>User</a>&gt; = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;
<a href='/constructor/messages.savedDialogsSlice'>messages.savedDialogsSlice</a>#44ba9dd9 count:<a href='/type/int'>int</a> dialogs:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/SavedDialog'>SavedDialog</a>&gt; messages:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Message'>Message</a>&gt; chats:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Chat'>Chat</a>&gt; users:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/User'>User</a>&gt; = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;
<a href='/constructor/messages.savedDialogsNotModified'>messages.savedDialogsNotModified</a>#c01f6fe8 count:<a href='/type/int'>int</a> = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;

<a href='/constructor/savedDialog'>savedDialog</a>#bd87cb6c flags:<a href='/type/%23'>#</a> pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/constructor/true'>true</a> peer:<a href='/type/Peer'>Peer</a> top_message:<a href='/type/int'>int</a> = <a href='/type/SavedDialog'>SavedDialog</a>;

---functions---

<a href='/method/messages.getSavedDialogs'>messages.getSavedDialogs</a>#1e91fc99 flags:<a href='/type/%23'>#</a> exclude_pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/constructor/true'>true</a> parent_peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/type/InputPeer'>InputPeer</a> offset_date:<a href='/type/int'>int</a> offset_id:<a href='/type/int'>int</a> offset_peer:<a href='/type/InputPeer'>InputPeer</a> limit:<a href='/type/int'>int</a> hash:<a href='/type/long'>long</a> = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;
<a href='/method/messages.getSavedDialogsByID'>messages.getSavedDialogsByID</a>#6f6f9c96 flags:<a href='/type/%23'>#</a> parent_peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/type/InputPeer'>InputPeer</a> ids:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/InputPeer'>InputPeer</a>&gt; = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;
<a href='/method/messages.getSavedHistory'>messages.getSavedHistory</a>#998ab009 flags:<a href='/type/%23'>#</a> parent_peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/InputPeer'>InputPeer</a> peer:<a href='/type/InputPeer'>InputPeer</a> offset_id:<a href='/type/int'>int</a> offset_date:<a href='/type/int'>int</a> add_offset:<a href='/type/int'>int</a> limit:<a href='/type/int'>int</a> max_id:<a href='/type/int'>int</a> min_id:<a href='/type/int'>int</a> hash:<a href='/type/long'>long</a> = <a href='/type/messages.Messages'>messages.Messages</a>;
<a href='/method/messages.deleteSavedHistory'>messages.deleteSavedHistory</a>#4dc5085f flags:<a href='/type/%23'>#</a> parent_peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/InputPeer'>InputPeer</a> peer:<a href='/type/InputPeer'>InputPeer</a> max_id:<a href='/type/int'>int</a> min_date:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/int'>int</a> max_date:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/type/int'>int</a> = <a href='/type/messages.AffectedHistory'>messages.AffectedHistory</a>;
<a href='/method/messages.getPinnedSavedDialogs'>messages.getPinnedSavedDialogs</a>#d63d94e0 = <a href='/type/messages.SavedDialogs'>messages.SavedDialogs</a>;
<a href='/method/messages.toggleSavedDialogPin'>messages.toggleSavedDialogPin</a>#ac81bbde flags:<a href='/type/%23'>#</a> pinned:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/constructor/true'>true</a> peer:<a href='/type/InputDialogPeer'>InputDialogPeer</a> = <a href='/type/Bool'>Bool</a>;
<a href='/method/messages.reorderPinnedSavedDialogs'>messages.reorderPinnedSavedDialogs</a>#8b716587 flags:<a href='/type/%23'>#</a> force:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/constructor/true'>true</a> order:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/InputDialogPeer'>InputDialogPeer</a>&gt; = <a href='/type/Bool'>Bool</a>;


<a href='/method/messages.search'>messages.search</a>#29ee847a flags:<a href='/type/%23'>#</a> peer:<a href='/type/InputPeer'>InputPeer</a> q:<a href='/type/string'>string</a> from_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/InputPeer'>InputPeer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/InputPeer'>InputPeer</a> saved_reaction:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Reaction'>Reaction</a>&gt; top_msg_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/type/int'>int</a> filter:<a href='/type/MessagesFilter'>MessagesFilter</a> min_date:<a href='/type/int'>int</a> max_date:<a href='/type/int'>int</a> offset_id:<a href='/type/int'>int</a> add_offset:<a href='/type/int'>int</a> limit:<a href='/type/int'>int</a> max_id:<a href='/type/int'>int</a> min_id:<a href='/type/int'>int</a> hash:<a href='/type/long'>long</a> = <a href='/type/messages.Messages'>messages.Messages</a>;
<a href='/method/messages.getSearchCounters'>messages.getSearchCounters</a>#1bbcf300 flags:<a href='/type/%23'>#</a> peer:<a href='/type/InputPeer'>InputPeer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/InputPeer'>InputPeer</a> top_msg_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/int'>int</a> filters:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/MessagesFilter'>MessagesFilter</a>&gt; = <a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/messages.SearchCounter'>messages.SearchCounter</a>&gt;;
<a href='/method/messages.getSearchResultsCalendar'>messages.getSearchResultsCalendar</a>#6aa3f6bd flags:<a href='/type/%23'>#</a> peer:<a href='/type/InputPeer'>InputPeer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/InputPeer'>InputPeer</a> filter:<a href='/type/MessagesFilter'>MessagesFilter</a> offset_id:<a href='/type/int'>int</a> offset_date:<a href='/type/int'>int</a> = <a href='/type/messages.SearchResultsCalendar'>messages.SearchResultsCalendar</a>;
<a href='/method/messages.getSearchResultsPositions'>messages.getSearchResultsPositions</a>#9c7f2f10 flags:<a href='/type/%23'>#</a> peer:<a href='/type/InputPeer'>InputPeer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/InputPeer'>InputPeer</a> filter:<a href='/type/MessagesFilter'>MessagesFilter</a> offset_id:<a href='/type/int'>int</a> limit:<a href='/type/int'>int</a> = <a href='/type/messages.SearchResultsPositions'>messages.SearchResultsPositions</a>;</code></pre>
<p>Messages sent and forwarded from various users (including ourselves) to Saved Messages are automatically categorized by their original dialog into a saved dialog list, quite similar to the normal dialog list used to normally interact with chats.  </p>
<p>To add new dialogs to the normal dialog list a user has to write to them (or join a channel/chat, etc.).<br>
To add new dialogs to the saved dialog list, simply forward messages from any normal dialog to <a href="/constructor/inputPeerSelf">inputPeerSelf</a> (the current user): the forwarded messages (including outgoing ones) will be added to a saved dialog with the same ID of the original dialog.</p>
<p>This includes outgoing messages, for example assume the following:</p>
<ul>
<li>Our user <code>id</code> is equal to <code>11111111</code></li>
<li>We send a message A with ID <code>10</code> to a <a href="/api/channel">supergroup</a> with <code>id=-100122222222</code> (bot API format, equivalent to a <a href="/constructor/peerChannel">peerChannel</a> with ID <code>122222222</code>) </li>
<li>Another user with <code>id=133333333</code> replies <code>B</code> to our previous message, message ID <code>11</code></li>
<li>We forward both messages <code>A</code> and <code>B</code> with IDs <code>10</code> and <code>11</code> to <a href="/constructor/inputPeerSelf">inputPeerSelf</a>, which will:<ul>
<li>Create a new <a href="/constructor/savedDialog">savedDialog</a> with <code>peer=-100122222222</code> (if it doesn't exist already because we already forwarded messages from that supergroup)</li>
<li>Generate two messages:<ul>
<li>Message <code>A</code>:<ul>
<li><code>id</code>: an unrelated message ID, the next one in the common ID sequence, for example <code>1234</code></li>
<li><code>peer_id</code>: <code>11111111</code></li>
<li><code>saved_peer_id</code>: <code>-100122222222</code></li>
<li><code>fwd_from.from_id</code>: <code>11111111</code></li>
<li><code>fwd_from.saved_from_peer</code>: <code>-100122222222</code></li>
<li><code>fwd_from.saved_from_msg_id</code>: <code>10</code></li>
</ul>
</li>
<li>Message <code>B</code>:<ul>
<li><code>id</code>: an unrelated message ID, the next one in the common ID sequence, for example <code>1235</code></li>
<li><code>reply_to.reply_to_msg_id</code>: <code>1234</code></li>
<li><code>peer_id</code>: <code>11111111</code></li>
<li><code>saved_peer_id</code>: <code>-100122222222</code></li>
<li><code>fwd_from.from_id</code>: <code>133333333</code></li>
<li><code>fwd_from.saved_from_peer</code>: <code>-100122222222</code></li>
<li><code>fwd_from.saved_from_msg_id</code>: <code>11</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Saving messages from private chats with users with forward privacy enabled will add them to a saved dialog entry of a special anonymous user with <code>id=2666000</code>.  </p>
<p>Clients may use the following pseudocode to manually populate the <code>saved_peer_id</code> of old <code>layer &lt; 170</code> <a href="/constructor/message">message</a>s stored in the <strong>local</strong> database.  </p>
<pre><code>// user_id is the ID of the current user.

if (message.peer_id == user_id) {
  if (message.fwd_from.saved_from_peer) {
    message.saved_peer_id = message.fwd_from.saved_from_peer
  } elseif (message.fwd_from.from_id) {
    message.saved_peer_id = user_id;
  } elseif (message.fwd_from.from_name) {
    message.saved_peer_id = 2666000;
  } else {
    message.saved_peer_id = user_id;
  }
}</code></pre>
<p>Sending (not forwarding from another dialog) new messages directly to ourselves will add them to a saved dialog entry with ourselves.  </p>
<p><strong>Note</strong>: the <code>saved_peer_id</code> field of messages is also used to implement a distinct feature, <a href="/api/monoforum">direct channel messages »</a>: in this case, the <code>peer_id</code> will be equal to the ID of the direct channel messages monoforum.  </p>
<p>A set of methods can then be used to obtain this dialog list, pin/unpin dialogs inside of it, view and remove messages from saved dialogs: <a href="/method/messages.getSavedDialogs">messages.getSavedDialogs</a>, <a href="/method/messages.getSavedDialogsByID">messages.getSavedDialogsByID</a>, <a href="/method/messages.getSavedHistory">messages.getSavedHistory</a>, <a href="/method/messages.deleteSavedHistory">messages.deleteSavedHistory</a>, <a href="/method/messages.getPinnedSavedDialogs">messages.getPinnedSavedDialogs</a>, <a href="/method/messages.toggleSavedDialogPin">messages.toggleSavedDialogPin</a>, <a href="/method/messages.reorderPinnedSavedDialogs">messages.reorderPinnedSavedDialogs</a> work just like their counterparts <a href="/method/messages.getDialogs">messages.getDialogs</a>, <a href="/method/messages.getHistory">messages.getHistory</a>, <a href="/method/messages.deleteHistory">messages.deleteHistory</a>, <a href="/method/messages.getPinnedDialogs">messages.getPinnedDialogs</a>, <a href="/method/messages.toggleDialogPin">messages.toggleDialogPin</a>, <a href="/method/messages.reorderPinnedDialogs">messages.reorderPinnedDialogs</a>, with the sole difference that they affect the saved dialog list, instead of the main dialog list.  </p>
<p>Some of the methods listed above have an optional <code>parent_peer</code> parameter, which should only be populated when working with <a href="/api/monoforum">monoforums</a>, not when working with saved messages.  </p>
<p>To search for messages within a saved dialog, use the usual <a href="/method/messages.search">messages.search</a>, <a href="/method/messages.getSearchCounters">messages.getSearchCounters</a>, <a href="/method/messages.getSearchResultsCalendar">messages.getSearchResultsCalendar</a>, <a href="/method/messages.getSearchResultsPositions">messages.getSearchResultsPositions</a> methods with <code>peer</code>=<a href="/constructor/inputPeerSelf">inputPeerSelf</a> and <code>saved_peer_id</code>=id of the saved dialog.  </p>
<p>The API also offers a <a href="/method/messages.readSavedHistory">messages.readSavedHistory</a> method, but unlike what the name suggests, it can only be used for <a href="/api/monoforum">monoforum</a> topics.  </p>
<h3><a class="anchor" href="#tags" id="tags" name="tags"><i class="anchor-icon"></i></a>Tags</h3>
<p>For even more organization, <a href="/api/premium">Premium users</a> can add <strong>multiple tags</strong> to your Saved Messages that let you quickly <strong>filter</strong> them in Search.</p>
<pre><code><a href='/constructor/messageReactions'>messageReactions</a>#a339f0b flags:<a href='/type/%23'>#</a> min:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/constructor/true'>true</a> can_see_list:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/constructor/true'>true</a> reactions_as_tags:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/constructor/true'>true</a> results:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/ReactionCount'>ReactionCount</a>&gt; recent_reactions:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/MessagePeerReaction'>MessagePeerReaction</a>&gt; top_reactors:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.4?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/MessageReactor'>MessageReactor</a>&gt; = <a href='/type/MessageReactions'>MessageReactions</a>;

<a href='/constructor/savedReactionTag'>savedReactionTag</a>#cb6ff828 flags:<a href='/type/%23'>#</a> reaction:<a href='/type/Reaction'>Reaction</a> title:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/string'>string</a> count:<a href='/type/int'>int</a> = <a href='/type/SavedReactionTag'>SavedReactionTag</a>;

<a href='/constructor/messages.savedReactionTagsNotModified'>messages.savedReactionTagsNotModified</a>#889b59ef = <a href='/type/messages.SavedReactionTags'>messages.SavedReactionTags</a>;
<a href='/constructor/messages.savedReactionTags'>messages.savedReactionTags</a>#3259950a tags:<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/SavedReactionTag'>SavedReactionTag</a>&gt; hash:<a href='/type/long'>long</a> = <a href='/type/messages.SavedReactionTags'>messages.SavedReactionTags</a>;

<a href='/constructor/updateSavedReactionTags'>updateSavedReactionTags</a>#39c67432 = <a href='/type/Update'>Update</a>;

---functions---

<a href='/method/messages.sendReaction'>messages.sendReaction</a>#d30d78d4 flags:<a href='/type/%23'>#</a> big:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/constructor/true'>true</a> add_to_recent:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/constructor/true'>true</a> peer:<a href='/type/InputPeer'>InputPeer</a> msg_id:<a href='/type/int'>int</a> reaction:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Reaction'>Reaction</a>&gt; = <a href='/type/Updates'>Updates</a>;

<a href='/method/messages.search'>messages.search</a>#29ee847a flags:<a href='/type/%23'>#</a> peer:<a href='/type/InputPeer'>InputPeer</a> q:<a href='/type/string'>string</a> from_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/InputPeer'>InputPeer</a> saved_peer_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.2?<a href='/type/InputPeer'>InputPeer</a> saved_reaction:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.3?<a href='/type/Vector%20t'>Vector</a>&lt;<a href='/type/Reaction'>Reaction</a>&gt; top_msg_id:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.1?<a href='/type/int'>int</a> filter:<a href='/type/MessagesFilter'>MessagesFilter</a> min_date:<a href='/type/int'>int</a> max_date:<a href='/type/int'>int</a> offset_id:<a href='/type/int'>int</a> add_offset:<a href='/type/int'>int</a> limit:<a href='/type/int'>int</a> max_id:<a href='/type/int'>int</a> min_id:<a href='/type/int'>int</a> hash:<a href='/type/long'>long</a> = <a href='/type/messages.Messages'>messages.Messages</a>;

<a href='/method/messages.getDefaultTagReactions'>messages.getDefaultTagReactions</a>#bdf93428 hash:<a href='/type/long'>long</a> = <a href='/type/messages.Reactions'>messages.Reactions</a>;

<a href='/method/messages.updateSavedReactionTag'>messages.updateSavedReactionTag</a>#60297dec flags:<a href='/type/%23'>#</a> reaction:<a href='/type/Reaction'>Reaction</a> title:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/string'>string</a> = <a href='/type/Bool'>Bool</a>;
<a href='/method/messages.getSavedReactionTags'>messages.getSavedReactionTags</a>#3637e05b flags:<a href='/type/%23'>#</a> peer:<a href='/mtproto/TL-combinators#conditional-fields'>flags</a>.0?<a href='/type/InputPeer'>InputPeer</a> hash:<a href='/type/long'>long</a> = <a href='/type/messages.SavedReactionTags'>messages.SavedReactionTags</a>;</code></pre>
<p>Tags are based on <a href="/api/reactions">reactions »</a>: adding a tag to a saved message is as easy as <a href="/api/reactions">reacting to it »</a> using <a href="/method/messages.sendReaction">messages.sendReaction</a>.  </p>
<p>Reactions are considered as tags only for saved messages, if the following conditions are met:</p>
<ul>
<li>The saved message did not previously have any reaction,</li>
<li>OR if the saved message already has some reactions <em>and</em> the <a href="/constructor/messageReactions">messageReactions</a>.<code>reactions_as_tags</code> flag is set.<br>
If the <code>reactions_as_tags</code> flag is not set on a saved message with at least one reaction, the reaction was added before tags were introduced (before layer 171).  In this case, to enable adding reaction tags, the user must first remove all existing reactions on the message, and then re-add the appropriate reaction tags.  </li>
</ul>
<p>You may search for saved messages tagged with one or more reactions using the <code>saved_reaction</code> parameter of <a href="/method/messages.search">messages.search</a>.  </p>
<p><a href="/method/messages.getDefaultTagReactions">messages.getDefaultTagReactions</a> can be used to fetch a default recommended list of tag reactions.  </p>
<p>The user may also assign a name (max 12 UTF-8 chars) to a tag reaction using <a href="/method/messages.updateSavedReactionTag">messages.updateSavedReactionTag</a>; to remove the name, call the same method without setting the <code>title</code> flag.  </p>
<p><a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a> can be used to fetch and locally cache the full list of reaction tag names assigned by the user; a <code>peer</code> may be optionally specified, to fetch only reaction tags used on messages of a specific <a href="#saved-message-dialogs">saved message dialog</a>.<br>
Updating the name of a reaction tag will emit an <a href="/constructor/updateSavedReactionTags">updateSavedReactionTags</a> update to all logged-in sessions except for the current one; this update should trigger a call to <a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a> <em>without</em> setting the <code>peer</code> flag to refresh the locally cached list.  </p>
<p>The client that updated the reaction tag won't get a <a href="/constructor/updateSavedReactionTags">updateSavedReactionTags</a>: in this case, the client can choose to manually invoke <a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a> every time it updates the reaction tags, or, to avoid making the extra call, it can choose to manually update the cached list, in this case the <code>hash</code> should be regenerated using the following algorithm:</p>
<pre><code>string remove_emoji_selectors(string emoji) {
  string str;
  for (i = 0; i &lt; len(emoji); i++) {
    if (i + 3 &lt;= len(emoji) &amp;&amp; emoji[i] == '\xEF' &amp;&amp; emoji[i + 1] == '\xB8' &amp;&amp; emoji[i + 2] == '\x8F') {
      // skip \uFE0F
      i += 2;
    } else {
      str += emoji[i];
    }
  }
  return str;
}

uint64 get_md5_string_hash(string str) {
  // Binary md5 hash, not hex
  string hash = md5(str);

  uint64 result = 0;
  for (int i = 0; i &lt;= 7; i++) {
    result += ((uint64)hash[i]) &lt;&lt; (56 - 8 * i);
  }
  return result;
}

vector&lt;uint64&gt; numbers = [];

// tags is an array of savedReactionTag constructors
foreach (tags as tag) {
  if tag.reaction instanceof reactionEmoji {
    numbers.append(get_md5_string_hash(remove_emoji_selectors(tag.reaction.emoticon)))
  } else if reaction instanceof reactionCustomEmoji {
    numbers.append(tag.reaction.document_id)
  }
  if (len(tag.title) &gt; 0) {
    numbers.append(get_md5_string_hash(tag.title));
  }
  numbers.append(tag.count);
}</code></pre>
<p>The generated list of 64-bit integers must then be passed to the <a href="/api/offsets#hash-generation">usual hashing algorithm</a>.  </p>
<p>If non-empty, the list of saved reaction tags returned by <a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a> should be shown in the UI just below the search input bar, in descending order by <code>count</code>; if searching within a specific <a href="#saved-message-dialogs">saved message dialog</a>, use <code>peer</code> to only return tags used in a specific saved message dialog.  </p>
<p>The tag reaction selection UI, on the other hand, should first display the reactions returned by <a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a> (global tag list, i.e. without <code>peer</code> regardless of the current saved message dialog) in descending order by <code>count</code>, then the reactions returned by <a href="/method/messages.getDefaultTagReactions">messages.getDefaultTagReactions</a> that weren't already returned by <a href="/method/messages.getSavedReactionTags">messages.getSavedReactionTags</a>, then any installed <a href="/api/custom-emoji">custom emoji packs</a>.</p></div>
  
</div>
          
        </div>
      </div>
      <div class="footer_wrap">
  <div class="footer_columns_wrap footer_desktop">
    <div class="footer_column footer_column_telegram">
      <h5>Telegram</h5>
      <div class="footer_telegram_description"></div>
      Telegram is a cloud-based mobile and desktop messaging app with a focus on security and speed.
    </div>

    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
      <ul>
        <li><a href="//telegram.org/faq">FAQ</a></li>
        <li><a href="//telegram.org/privacy">Privacy</a></li>
        <li><a href="//telegram.org/press">Press</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#mobile-apps">Mobile Apps</a></h5>
      <ul>
        <li><a href="//telegram.org/dl/ios">iPhone/iPad</a></li>
        <li><a href="//telegram.org/android">Android</a></li>
        <li><a href="//telegram.org/dl/web">Mobile Web</a></li>
      </ul>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/apps#desktop-apps">Desktop Apps</a></h5>
      <ul>
        <li><a href="//desktop.telegram.org/">PC/Mac/Linux</a></li>
        <li><a href="//macos.telegram.org/">macOS</a></li>
        <li><a href="//telegram.org/dl/web">Web-browser</a></li>
      </ul>
    </div>
    <div class="footer_column footer_column_platform">
      <h5><a href="//core.telegram.org/">Platform</a></h5>
      <ul>
        <li><a href="//core.telegram.org/api">API</a></li>
        <li><a href="//translations.telegram.org/">Translations</a></li>
        <li><a href="//instantview.telegram.org/">Instant View</a></li>
      </ul>
    </div>
  </div>
  <div class="footer_columns_wrap footer_mobile">
    <div class="footer_column">
      <h5><a href="//telegram.org/faq">About</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/blog">Blog</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/press">Press</a></h5>
    </div>
    <div class="footer_column">
      <h5><a href="//telegram.org/moderation">Moderation</a></h5>
    </div>
  </div>
</div>
    </div>
    <script src="/js/main.js?47"></script>
    <script src="/js/jquery.min.js?1"></script>
<script src="/js/bootstrap.min.js?1"></script>

    <script>window.initDevPageNav&&initDevPageNav();
backToTopInit("Go up");
removePreloadInit();
</script>
  </body>
</html>

